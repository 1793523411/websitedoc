## 图片的懒加载和预加载

相关知识点：

预加载：提前加载图片，当用户需要查看时可直接从本地缓存中渲染。

懒加载：懒加载的主要目的是作为服务器前端的优化，减少请求数或延迟请求数。

两种技术的本质：两者的行为是相反的，一个是**提前加载**，一个是**迟缓甚至不加载**。 懒加载对务器前端有一定的缓解压力作用，预加载则会增加服务器前端压力。

回答：

懒加载也叫延迟加载，指的是在长网页中延迟加载图片的时机，当用户需要访问时，再去加载，这样可以提高网站的首屏加载速度，提升用户的体验，并且可以减少服务器的压力。它适用于图片很多，页面很长的电商网站的场景。懒加载的实现原理是，将页面上的图片的 src 属性设置为空字符串，**将图片的真实路径保存在一个自定义属性中，当页面滚动的时候，进行判断，如果图片进入页面可视区域内，则从自定义属性中取出真实路径赋值给图片的 src 属性**，以此来实现图片的延迟加载。

预加载指的是将所需的资源提前请求加载到本地，这样后面在需要用到时就直接从缓存取资源。通过预加载能够减少用户的等待时间，提高用户的体验。我了解的预加载的最常用的方式是**使用 js 中的 image 对象**，**通过为 image 对象来设置 scr 属性**，来实现图片的预加载。这两种方式都是提高网页性能的方式，两者主要区别是一个是提前加载，一个是迟缓甚至不加载。

**懒加载对服务器前端有一定的缓解压力作用，预加载则会增加服务器前端压力**。

## 关于 transform 开启 GPU 加速渲染，相比 top&left，优势在哪里

页面性能优化有一条，用 transform 代替 top，left 来实现动画。那么 transform 的优势在哪里？如何开启 GPU 加速渲染？开启 GPU 硬件加速可能会触发的问题，如何解决？

首先相比定位的 top&left 来说，transform 不会引起整个页面的回流和重绘。其次我们可以**通过 transform 开启 GPU 硬件加速，提高渲染速度，但相应的 transform 也会占用更多的内存**。

开启 GPU 硬件加速：

```css
.box {
  transform: translateZ(0);
  /* 或者 */
  transfor: translate3d(0, 0, 0);
}
```

开启 GPU 硬件加速可能会导致浏览器频繁闪烁或者抖动,解决方案:

```css
.box {
  backface-visibility: hidden;
  perspective: 1000;
  -webkit-backface-visibility: hidden;
  -webkit-perspective: 1000;
}
```

## 前端性能优化

前端性能优化主要是为了提高页面的加载速度，优化用户的访问体验。我认为可以从这些方面来进行优化。

第一个方面是页面的内容方面

（1）通过文件合并、css 雪碧图、使用 base64 等方式来**减少 HTTP 请求数**，避免过多的请求造成等待的情况。

（2）通过 **DNS** 缓存等机制来减少 DNS 的查询次数。

（3）通过设置**缓存策略**，对常用不变的资源进行缓存。

（4）使用**延迟加载**的方式，来减少页面首屏加载时需要请求的资源。延迟加载的资源当用户需要访问时，再去请求加载。

（5）通过用户行为，对某些资源使用**预加载**的方式，来提高用户需要访问资源时的响应速度。

第二个方面是服务器方面

（1）使用 **CDN** 服务，来提高用户对于资源请求时的响应速度。

（2）服务器端启用 Gzip、Deflate 等方式**对于传输的资源进行压缩**，减小文件的体积。

（3）尽可能**减小 cookie 的大小**，并且通过将静态资源分配到其他域名下，来避免对静态资源请求时携带不必要的 cookie

第三个方面是 CSS 和 JavaScript 方面

（1）把**样式表放在页面的 head 标签中，减少页面的首次渲染的时间**。

（2）**避免使用 @import 标签**。

（3）尽量把** js 脚本放在页面底部或者使用 defer 或 async 属性**，避免脚本的加载和执行阻塞页面的渲染。

（4）通过对 JavaScript 和 CSS 的文件进行**压缩**，来减小文件的体积。

## 网站性能优化

答案：

样本一

- 减少 http 请求次数：CSS Sprites, JS、CSS 源码压缩、图片大小控制合适；网页 Gzip，CDN 托管，data 缓存 ，图片服务器。
- 前端模板 JS+数据，减少由于 HTML 标签导致的带宽浪费，前端用变量保存 AJAX 请求结果，每次操作本地变量，不用请求，减少请求次数
- 用 innerHTML 代替 DOM 操作，减少 DOM 操作次数，优化 javascript 性能。
- 当需要设置的样式很多时设置 className 而不是直接操作 style。
- 少用全局变量、缓存 DOM 节点查找的结果。减少 IO 读取操作。
- 避免使用 CSS Expression（css 表达式)又称 Dynamic properties(动态属性)。
- 图片预加载，将样式表放在顶部，将脚本放在底部 加上时间戳。
- 避免在页面的主体布局中使用 table，table 要等其中的内容完全下载之后才会显示出来，显示比 div+css 布局慢。

样本二

- 减少 HTTP 请求
- 减少 DOM 操作
- 避免不必要的重绘与重排
- 优化 CSS 选择器（从右向左匹配）
- CSS/JS minify，减少文件体积
- 开启 Gzip 压缩
- 将 CSS 放到顶部，JavaScript 放到尾部
- 压缩图片以及使用 CSS Sprite
- 使用 CDN 加速，适当进行文件缓存
- 合理控制 cookie 大小（每次请求都会包含 cookie）

## 简述一下你对 web 性能优化的方案

答案：

1、尽量减少 HTTP 请求
2、使用浏览器缓存
3、使用压缩组件
4、图片、JS 的预载入
5、将脚本放在底部
6、将样式文件放在页面顶部
7、使用外部的 JS 和 CSS
8、精简代码

## 移动端性能优化

答案：

尽量使用 css3 动画，开启硬件加速。适当使用 touch 事件代替 click 事件。避免使用 css3 渐变阴影效果。 尽可能少的使用 box-shadow 与 gradients。box-shadow 与 gradients 往往都是页面的性能杀手


##  页面大量图片，如何优化加载，优化用户体验

答案：

图片懒加载，在页面上的未可视区域可以添加一个滚动条事件，判断图片位置与浏览器顶端的距离与页面的距离，如果前者小于后者，优先加载。

如果为幻灯片、相册等，可以使用图片预加载技术，将当前展示图片的前一张和后一张优先下载。

如果图片为 css 图片，可以使用 CSSsprite，SVGsprite，Iconfont、Base64 等技术。

如果图片过大，可以使用特殊编码的图片，加载时会先加载一张压缩的特别厉害的缩略图，以提高用户体验。

如果图片展示区域小于图片的真实大小，则因在服务器端根据业务需要先行进行图片压缩，图片压缩后大小与展示一致。



## 渲染优化

答案：

```
1、禁止使用 iframe（阻塞父文档 onload 事件）；
*iframe 会阻塞主页面的 Onload 事件；
*搜索引擎的检索程序无法解读这种页面，不利于 SEO;
*iframe 和主页面共享连接池，而浏览器对相同域的连接有限制，所以会影响页面的并行加载。

使用 iframe 之前需要考虑这两个缺点。如果需要使用 iframe，最好是通过 javascript
动态给 iframe 添加 src 属性值，这样可以绕开以上两个问题。

2、禁止使用 gif 图片实现 loading 效果（降低 CPU 消耗，提升渲染性能）；
3、使用 CSS3 代码代替 JS 动画（尽可能避免重绘重排以及回流）css3 平面动画开启 translateZ(0)，打开浏览器 3d 加速，在一定程度可缓解卡顿。不宜多用；
4、对于一些小图标，可以使用 base64 位编码，以减少网络请求。但不建议大图使用，比较耗费 CPU；
小图标优势在于： 1.减少 HTTP 请求； 2.避免文件跨域； 3.修改及时生效；
5、页面头部的`<style></style>` 会阻塞页面；（因为 Renderer 进程中 JS 线程和渲染线程是互斥的）；
6、页面头部`<script</script>` 会阻塞页面；（因为 Renderer 进程中 JS 线程和渲染线程是互斥的）；
7、页面中空的 href 和 src 会阻塞页面其他资源的加载 (阻塞下载进程)；
8、网页 Gzip，CDN 托管，data 缓存 ，图片服务器；
9、前端模板 JS+数据，减少由于 HTML 标签导致的带宽浪费，前端用变量保存 AJAX 请求结果，每次操作本地变量，不用请求，减少请求次数
10、用 innerHTML 代替 DOM 操作，减少 DOM 操作次数，优化 javascript 性能。
11、当需要设置的样式很多时设置 className 而不是直接操作 style。
12、少用全局变量、缓存 DOM 节点查找的结果。减少 IO 读取操作。
13、避免使用 CSS Expression（css 表达式)又称 Dynamic properties(动态属性)。
14、图片预加载，将样式表放在顶部，将脚本放在底部 加上时间戳。
15、 避免在页面的主体布局中使用 table，table 要等其中的内容完全下载之后才会显示出来，显示比 div+css 布局慢。
对普通的网站有一个统一的思路，就是尽量向前端优化、减少数据库操作、减少磁盘 IO。
向前端优化指的是，在不影响功能和体验的情况下，能在浏览器执行的不要在服务端执行，
能在缓存服务器上直接返回的不要到应用服务器，程序能直接取得的结果不要到外部取得，
本机内能取得的数据不要到远程取，内存能取到的不要到磁盘取，缓存中有的不要去数据库查询。
减少数据库操作指减少更新次数、缓存结果减少查询次数、将数据库执行的操作尽可能的让你的程序完成（例如 join 查询），
减少磁盘 IO 指尽量不使用文件系统作为缓存、减少读写文件次数等。程序优化永远要优化慢的部分，换语言是无法“优化”的。
16、通过改变 src 的情况下\*\*.MP3（不同于 mp3）在移动端有可能不能播放。
```

## 前端性能优化的方案有哪些

前端性能优化**七大常用的优化手段**：减少请求数量，减小资源大小，优化网络连接，优化资源加载，减少回流重绘，使用更好性能的 API 和构建优化

- 减少请求数量
  - 文件合并，并按需分配（公共库合并，其他页面组件按需分配）
  - 图片处理：使用雪碧图，将图片转码 base64 内嵌到 HTML 中，使用字体图片代替图片
  - 减少重定向：尽量避免使用重定向，当页面发生了重定向，就会延迟整个 HTML 文档的传输
  - 使用缓存：即利用浏览器的强缓存和协商缓存
  - 不使用 CSS @import：CSS 的@import 会造成额外的请求
  - 避免使用空的 src 和 href：a 标签设置空的 href，会重定向到当前的页面地址，form 设
  - 置空的 method，会提交表单到当前的页面地址
- 减小资源大小

  - 压缩：静态资源删除无效冗余代码并压缩
  - webp：更小体积
  - 开启 gzip：HTTP 协议上的 GZIP 编码是一种用来改进 WEB 应用程序性能的技术

- 优化网络连接
  - 使用 CDN
  - 使用 DNS 预解析：DNS Prefetch，即 DNS 预解析就是根据浏览器定义的规则，提前解析之后可能会用到的域名，使解析结果缓存到 系统缓存 中，缩短 DNS 解析时间，来提高网站的访问速度
  - ```html
    <!--   方法是在 head 标签里面写上几个 link 标签  -->
    <link rel="dns-prefecth" href="https://www.google.com" />
    <link rel="dns-prefecth" href="https://www.google-analytics.com" />
    ```
  - 并行连接：由于在 HTTP1.1 协议下，chrome 每个域名最大并发数是 6 个。使用多个域名，可以增加并发数
  - 管道化连接：在 HTTP2 协议中，可以开启管道化连接，即单条连接的多路复用
- 优化资源加载
- 减少重绘回流
- 使用性能更好的 API
- 构建优化：如 webpack 优化

## 在 css/js 代码上线之后开发人员经常会优化性能，从用户刷新网页开始，一次 js 请求一般情况下有哪些地方会有缓存处理？

dns 缓存，cdn 缓存，浏览器缓存，服务器缓存。